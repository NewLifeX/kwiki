# KWiki 模板系统

KWiki 现在使用基于模板的文档生成系统，支持多语言和可定制的提示词模板。

## 系统概述

### 核心特性

1. **基于模板的生成**: 文档生成完全基于模板文件，不再使用硬编码的提示词
2. **多语言支持**: 支持10种语言的模板
3. **YAML前置元数据**: 每个模板包含标题、类型、顺序等元数据
4. **动态页面数量**: 生成的文档页面数量取决于可用的模板文件数量
5. **可定制性**: 用户可以轻松添加、修改或删除模板

### 支持的语言

- `en` - English
- `zh` - 中文 (Chinese)
- `ja` - 日本語 (Japanese)
- `ko` - 한국어 (Korean)
- `es` - Español (Spanish)
- `fr` - Français (French)
- `de` - Deutsch (German)
- `ru` - Русский (Russian)
- `pt` - Português (Portuguese)
- `it` - Italiano (Italian)

## 模板结构

### 目录结构

```
templates/prompts/
├── config.yaml          # 模板配置
├── TEMPLATES.md         # 模板说明文档
├── en/                  # 英文模板
│   ├── readme.md
│   ├── getting-started.md
│   ├── installation.md
│   ├── architecture.md
│   └── api-reference.md
├── zh/                  # 中文模板
│   ├── readme.md
│   ├── getting-started.md
│   ├── installation.md
│   ├── architecture.md
│   └── api-reference.md
└── [其他语言]/
```

### 模板格式

每个模板文件包含YAML前置元数据和模板内容：

```markdown
---
title: README
type: overview
order: 1
---

# README页面生成提示词

为以下项目生成README文档：

**项目信息：**
- 项目: {{.ProjectName}}
- 描述: {{.Description}}
- 主要语言: {{.PrimaryLanguage}}

**模块结构：**
{{range .Modules}}
- **{{.Name}}**: {{.Description}}
{{end}}

**要求：**
生成包含以下部分的README文档：
1. 项目概述
2. 主要特性
3. 安装说明
4. 使用方法
```

### 元数据字段

- `title`: 页面标题（支持多语言）
- `type`: 页面类型（overview, guide, architecture, api）
- `order`: 页面顺序（数字，用于排序）

### 模板变量

所有模板都可以使用以下变量：

#### 项目信息
- `{{.ProjectName}}` - 项目名称
- `{{.Description}}` - 项目描述
- `{{.PrimaryLanguage}}` - 主要编程语言
- `{{.License}}` - 许可证信息
- `{{.Language}}` - 目标文档语言

#### 结构信息
- `{{.Modules}}` - 模块数组
  - `{{.Name}}` - 模块名称
  - `{{.Description}}` - 模块描述
  - `{{.Functions}}` - 函数数组
    - `{{.Name}}` - 函数名称
    - `{{.Description}}` - 函数描述

## 工作流程

### 1. 模板发现
系统自动扫描指定语言的模板目录，发现所有可用的模板文件。

### 2. 元数据解析
解析每个模板的YAML前置元数据，获取标题、类型、顺序等信息。

### 3. 模板排序
根据`order`字段对模板进行排序，确定生成页面的顺序。

### 4. 数据准备
将项目信息和代码结构转换为模板数据格式。

### 5. 模板渲染
使用Go的`text/template`引擎渲染每个模板，生成AI提示词。

### 6. AI生成
将渲染后的提示词发送给AI模型，生成最终的文档内容。

### 7. 页面创建
根据模板元数据创建WikiPage对象，包含标题、类型、顺序等信息。

## 测试覆盖

### 单元测试

1. **模板解析测试**
   - YAML前置元数据解析
   - 模板语法验证
   - 错误处理

2. **数据准备测试**
   - 项目信息转换
   - 模块和函数映射
   - 多语言支持

3. **模板渲染测试**
   - 变量替换
   - 循环和条件语句
   - 多语言模板

### 集成测试

1. **端到端生成测试**
   - 完整的页面生成流程
   - 多语言文档生成
   - 页面排序和元数据

2. **回退机制测试**
   - 语言回退到英文
   - 缺失模板处理
   - 错误恢复

## 自定义模板

### 添加新模板

1. 在相应语言目录下创建新的`.md`文件
2. 添加YAML前置元数据
3. 编写模板内容
4. 系统会自动发现并使用新模板

### 修改现有模板

1. 直接编辑模板文件
2. 修改元数据或内容
3. 重新生成文档即可使用新模板

### 添加新语言

1. 创建新的语言目录（如`templates/prompts/fr/`）
2. 复制英文模板并翻译
3. 调整元数据中的标题
4. 系统会自动支持新语言

## 优势

1. **灵活性**: 完全可定制的模板系统
2. **可扩展性**: 轻松添加新的文档类型和语言
3. **一致性**: 统一的模板格式和变量系统
4. **可维护性**: 模板与代码分离，易于维护
5. **多语言**: 原生支持多语言文档生成
6. **动态性**: 文档数量和类型完全由模板决定

## 未来扩展

1. **更多文档类型**: 可以添加更多专门的文档模板
2. **条件模板**: 根据项目特征选择不同的模板
3. **模板继承**: 支持模板之间的继承关系
4. **在线编辑**: Web界面的模板编辑功能
5. **模板市场**: 社区贡献的模板库
